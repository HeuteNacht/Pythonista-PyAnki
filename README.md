# PyAnki v5.0 (Pythonista Edition)

PyAnki 是一款专为 iOS 端 **Pythonista 3** 开发的高效记忆卡片工具。它采用了科学的 SuperMemo-2 间隔重复算法，并深度集成了 iOS 原生功能，如语音合成 (TTS)、录音、相册访问及简繁转换。

## 🌟 核心功能

- **智能算法**：内置 SM-2 算法，根据记忆质量（重来、困难、良好、简单）自动安排下次复习时间。
- **多媒体支持**：
    - **音频**：支持自定义录音（独立模态窗口，防闪退设计）及文件导入。
    - **图片**：支持从相册、相机或剪贴板导入图片，并支持删除管理。
- **语音合成 (TTS)**：支持普通话与粤语一键切换，针对 iOS 引擎进行了防崩溃缓冲处理。
- **文本工具**：支持简体中文一键转繁体（OpenCC 逻辑），支持 Excel 格式文本批量导入。
- **数据安全**：支持全量数据（卡片+音频+图片）的 Zip 压缩备份与恢复，方便跨设备迁移。
- **UI 优化**：卡片布局自动适配，支持长文本滚动查看，界面简洁易用。

## 📂 项目结构

- `main.py`: 程序入口，负责初始化音频会话并启动 UI。
- `ui_layer.py`: 界面逻辑层，处理所有按钮点击、弹窗及卡片渲染。
- `model.py`: 数据管理层，处理 JSON 读写、复习算法及文件系统操作。
- `utils.py`: 辅助工具层，包含简繁转换逻辑、TTS 调度及中文判定。
- `config.py`: 全局配置文件，定义路径、默认方言及初始化环境。
- `share_to_anki.py`: (扩展) 支持从 iOS 分享菜单或快捷指令快速添加卡片。

## 🚀 快速开始

1. 将所有 `.py` 文件下载到 Pythonista 3 的同一个文件夹内。
2. (可选) 如需简繁转换，请在 `config.py` 指定的目录下放置 OpenCC 字典文件。
3. 运行 `main.py` 启动程序。

## 🔧 技术要点 (针对 Pythonista)

- **稳定性修复**：通过 `@ui.in_background` 和 `ui.delay` 异步调度，解决了 Pythonista 频繁调用 `speech` 和 `sound` 导致的底层闪退问题。
- **布局适配**：动态计算 UI 控件位置，确保评分按钮在不同设备尺寸下均能与卡片宽度完美对齐。